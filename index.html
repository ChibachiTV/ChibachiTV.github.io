<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Binaural Beats & Noise Player</title>
  <style>
    :root{
      --bg:#0b0f1a; --card-bg:rgba(20,24,38,0.55); --border:rgba(255,255,255,0.08);
      --text:#e6e9f2; --muted:#a9b0c6; --accent1:#7c6cff; --accent2:#2ec0ff;
      --glow:0 0 40px rgba(124,108,255,0.25), 0 0 60px rgba(46,192,255,0.15);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial;
      color:var(--text);background:radial-gradient(1000px 600px at 10% 0%,rgba(124,108,255,.15),transparent 60%),
      radial-gradient(1000px 600px at 90% 100%,rgba(46,192,255,.12),transparent 60%),var(--bg);
      display:grid;place-items:center;padding:16px}
    .app{width:min(860px,100%);max-width:860px;display:grid;gap:16px}
    .title{text-align:center;font-weight:700;letter-spacing:.3px;font-size:clamp(18px,2.4vw,22px);opacity:.95}
    .card{background:var(--card-bg);border:1px solid var(--border);border-radius:18px;padding:18px 16px 16px;
      backdrop-filter:blur(10px) saturate(120%);-webkit-backdrop-filter:blur(10px) saturate(120%);box-shadow:var(--glow)}
    .section-head{display:flex;align-items:baseline;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:8px}
    .section-head h2{margin:0;font-size:18px;font-weight:700;letter-spacing:.4px;background:linear-gradient(90deg,var(--accent2),var(--accent1));-webkit-background-clip:text;background-clip:text;color:transparent}
    .small{color:var(--muted);font-size:12px}
    .display{text-align:center;margin:2px 0 10px}
    .band{font-size:24px;font-weight:800;letter-spacing:.6px}
    .flavor{color:var(--muted);font-size:13px;margin-top:2px}
    .row{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:720px){.row-2{grid-template-columns:1fr 1fr}}
    .slider{-webkit-appearance:none;appearance:none;width:100%;height:10px;border-radius:999px;outline:none;background:linear-gradient(90deg,rgba(124,108,255,.35),rgba(46,192,255,.35));position:relative;border:1px solid var(--border)}
    .slider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:18px;height:18px;border-radius:50%;background:linear-gradient(180deg,var(--accent1),var(--accent2));border:none;box-shadow:0 2px 10px rgba(0,0,0,.35);cursor:pointer}
    .slider::-moz-range-thumb{width:18px;height:18px;border-radius:50%;border:none;cursor:pointer;background:linear-gradient(180deg,var(--accent1),var(--accent2));box-shadow:0 2px 10px rgba(0,0,0,.35)}
    .labels{display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin-top:2px}
    .btn-row{display:flex;gap:8px;flex-wrap:wrap}
    .btn{padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,.03);color:var(--text);font-weight:600;letter-spacing:.2px;cursor:pointer;transition:transform .06s ease,background .2s ease,box-shadow .2s ease}
    .btn:hover{transform:translateY(-1px);background:rgba(255,255,255,.06);box-shadow:0 8px 20px rgba(0,0,0,.25)}
    .btn:active{transform:translateY(0)}
    .btn.active{background:linear-gradient(90deg,rgba(124,108,255,.35),rgba(46,192,255,.35));box-shadow:var(--glow)}
    .foot{text-align:center;color:var(--muted);font-size:11px;margin-top:2px}
    .hint{font-size:11px;color:var(--muted);text-align:center;margin-top:8px}
  </style>
</head>
<body>
  <main class="app" role="application" aria-label="Binaural beats and noise player">
    <div class="title">Binaural Beats & Background Noise</div>

    <!-- BINAURAL BEATS -->
    <section class="card" aria-labelledby="beatsTitle">
      <div class="section-head">
        <h2 id="beatsTitle">Binaural Beats</h2>
        <div class="small" id="beatsStatus">Off</div>
      </div>
      <div class="display">
        <div class="band" id="bandLabel">—</div>
        <div class="flavor" id="bandFlavor">Slide right to begin (0 = Off)</div>
      </div>
      <div class="row">
        <label class="small" for="beatFreq">Beat Frequency (Hz) <span id="beatHz">0 Hz</span></label>
        <input id="beatFreq" class="slider" type="range" min="0" max="100" step="1" value="0" />
        <div class="labels small"><span>0</span><span>20</span><span>40</span><span>60</span><span>80</span><span>100</span></div>
      </div>
      <div class="row" style="margin-top:8px;">
        <label class="small" for="beatVol">Beat Volume <span id="beatVolPct">0%</span></label>
        <input id="beatVol" class="slider" type="range" min="0" max="1" step="0.01" value="0.6" />
      </div>
      <div class="hint">Binaural beats are created by sending slightly different pure tones to each ear. Use headphones.</div>
    </section>

    <!-- BACKGROUND NOISE -->
    <section class="card" aria-labelledby="noiseTitle">
      <div class="section-head">
        <h2 id="noiseTitle">Background Noise</h2>
        <div class="small" id="noiseStatus">Off</div>
      </div>
      <div class="btn-row" role="group" aria-label="Noise type">
        <button class="btn" data-noise="white">White</button>
        <button class="btn" data-noise="pink">Pink</button>
        <button class="btn" data-noise="brown">Brown</button>
      </div>
      <div class="row" style="margin-top:12px;">
        <label class="small" for="noiseVol">Noise Volume <span id="noiseVolPct">0%</span></label>
        <input id="noiseVol" class="slider" type="range" min="0" max="1" step="0.01" value="0.0" />
      </div>
      <div class="foot">Set volume to 0% to turn noise off. White = flat • Pink = −3 dB/oct • Brown = −6 dB/oct</div>
    </section>
  </main>

  <script>
    // --- Audio context setup ---
    let audioCtx;
    const ensureCtx = () => { if (!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)(); if (audioCtx.state==='suspended') audioCtx.resume(); return audioCtx; };

    // --- Elements ---
    const beatFreq = document.getElementById('beatFreq');
    const beatVol = document.getElementById('beatVol');
    const beatHzLabel = document.getElementById('beatHz');
    const beatVolPct = document.getElementById('beatVolPct');
    const bandLabel = document.getElementById('bandLabel');
    const bandFlavor = document.getElementById('bandFlavor');
    const beatsStatus = document.getElementById('beatsStatus');

    const noiseButtons = Array.from(document.querySelectorAll('[data-noise]'));
    const noiseVol = document.getElementById('noiseVol');
    const noiseVolPct = document.getElementById('noiseVolPct');
    const noiseStatus = document.getElementById('noiseStatus');

    // --- Binaural beats nodes ---
    let leftOsc, rightOsc, beatGain, leftPan, rightPan;
    function startBeats(){ ensureCtx(); if (leftOsc && rightOsc) return; const base=220; const diff=parseInt(beatFreq.value,10); if (diff===0) return; leftOsc=audioCtx.createOscillator(); rightOsc=audioCtx.createOscillator(); leftOsc.type='sine'; rightOsc.type='sine'; leftOsc.frequency.value=base; rightOsc.frequency.value=base+diff; beatGain=audioCtx.createGain(); beatGain.gain.value=parseFloat(beatVol.value); leftPan=audioCtx.createStereoPanner(); rightPan=audioCtx.createStereoPanner(); leftPan.pan.value=-1; rightPan.pan.value=1; leftOsc.connect(leftPan).connect(beatGain).connect(audioCtx.destination); rightOsc.connect(rightPan).connect(beatGain).connect(audioCtx.destination); leftOsc.start(); rightOsc.start(); beatsStatus.textContent='On'; }
    function stopBeats(){ if(leftOsc){try{leftOsc.stop();leftOsc.disconnect();}catch{} leftOsc=null;} if(rightOsc){try{rightOsc.stop();rightOsc.disconnect();}catch{} rightOsc=null;} if(beatGain){try{beatGain.disconnect();}catch{} beatGain=null;} if(leftPan){try{leftPan.disconnect();}catch{} leftPan=null;} if(rightPan){try{rightPan.disconnect();}catch{} rightPan=null;} beatsStatus.textContent='Off'; }
    function updateBeatFrequency(){ const diff=parseInt(beatFreq.value,10); beatHzLabel.textContent=diff+' Hz'; const {band,flavor}=bandFrom(diff); bandLabel.textContent=band; bandFlavor.textContent=flavor; if(diff===0){ bandLabel.textContent='—'; bandFlavor.textContent='Slide right to begin (0 = Off)'; stopBeats(); return;} startBeats(); if(rightOsc) rightOsc.frequency.setTargetAtTime(220+diff,audioCtx.currentTime,0.02); }
    function updateBeatVolume(){ const v=parseFloat(beatVol.value); beatVolPct.textContent=Math.round(v*100)+'%'; if(beatGain) beatGain.gain.setTargetAtTime(v,audioCtx.currentTime,0.02); }
    function bandFrom(hz){ if(hz===0) return {band:'Off',flavor:''}; if(hz<4) return {band:'Delta',flavor:'Deep Sleep / Meditation'}; if(hz<8) return {band:'Theta',flavor:'Meditation / Relaxation'}; if(hz<14) return {band:'Alpha',flavor:'Relax / Focus'}; if(hz<30) return {band:'Beta',flavor:'Problem-Solving'}; return {band:'Gamma',flavor:'Deeper Concentration'}; }

    // --- Noise generation (no Off button; 0% volume = Off) ---
    let selectedNoiseType = null; // 'white' | 'pink' | 'brown'
    let noiseSource = null, noiseGain = null;

    function setNoiseType(type){
      ensureCtx();
      selectedNoiseType = type;
      noiseButtons.forEach(b=>b.classList.toggle('active', b.dataset.noise===type));
      const v = parseFloat(noiseVol.value);
      if (v === 0) { // remember selection but do not play
        stopNoise();
        noiseStatus.textContent = 'Off';
        return;
      }
      // Rebuild the source on every type change so the sound switches immediately
      startNoiseWithType(type, v);
    }

    function startNoiseWithType(type, vol){
      if (!type) return;
      stopNoise();
      const buffer = generateNoiseBuffer(type, ensureCtx());
      noiseSource = audioCtx.createBufferSource();
      noiseSource.buffer = buffer; noiseSource.loop = true;
      noiseGain = audioCtx.createGain(); noiseGain.gain.value = vol;
      noiseSource.connect(noiseGain).connect(audioCtx.destination);
      noiseSource.start();
      noiseStatus.textContent = capitalize(type);
    }

    function stopNoise(){
      if (noiseSource){ try{ noiseSource.stop(); noiseSource.disconnect(); }catch{} noiseSource=null; }
      if (noiseGain){ try{ noiseGain.disconnect(); }catch{} noiseGain=null; }
    }

    function updateNoiseVolume(){
      const v = parseFloat(noiseVol.value);
      noiseVolPct.textContent = Math.round(v*100) + '%';
      if (v === 0){ stopNoise(); noiseStatus.textContent = 'Off'; return; }
      // If already playing, adjust gain; if not, start with the selected type
      if (noiseGain){ noiseGain.gain.setTargetAtTime(v, audioCtx.currentTime, 0.02); }
      else if (selectedNoiseType){ startNoiseWithType(selectedNoiseType, v); }
    }

    function generateNoiseBuffer(type, ctx){
      const length = ctx.sampleRate * 2; // 2 seconds loop
      const buffer = ctx.createBuffer(1, length, ctx.sampleRate);
      const data = buffer.getChannelData(0);
      if (type === 'white'){
        for (let i=0;i<length;i++) data[i] = Math.random()*2 - 1;
      } else if (type === 'pink'){
        // Voss–McCartney pink noise
        let b0=0,b1=0,b2=0,b3=0,b4=0,b5=0,b6=0;
        for (let i=0;i<length;i++){
          const white = Math.random()*2 - 1;
          b0 = 0.99886*b0 + white*0.0555179;
          b1 = 0.99332*b1 + white*0.0750759;
          b2 = 0.96900*b2 + white*0.1538520;
          b3 = 0.86650*b3 + white*0.3104856;
          b4 = 0.55000*b4 + white*0.5329522;
          b5 = -0.7616*b5 - white*0.0168980;
          data[i] = (b0+b1+b2+b3+b4+b5+b6*0.5362)*0.11;
          b6 = white*0.115926;
        }
      } else if (type === 'brown'){
        let lastOut = 0.0;
        for (let i=0;i<length;i++){
          const white = Math.random()*2 - 1;
          const out = (lastOut + 0.02*white) / 1.02;
          lastOut = out;
          data[i] = out * 3.5; // gain correction
        }
      }
      return buffer;
    }

    const capitalize = s => s ? s.charAt(0).toUpperCase() + s.slice(1) : s;

    // --- Wire up UI ---
    ['click','keydown','pointerdown','touchstart','mousedown'].forEach(evt=>{
      window.addEventListener(evt, ensureCtx, { once:true, passive:true });
    });

    beatFreq.addEventListener('input', updateBeatFrequency);
    beatVol.addEventListener('input', ()=>{ updateBeatVolume(); if (!leftOsc && parseInt(beatFreq.value,10)>0) startBeats(); });

    noiseButtons.forEach(btn=> btn.addEventListener('click', ()=> setNoiseType(btn.dataset.noise)));
    noiseVol.addEventListener('input', updateNoiseVolume);

    // Initialize labels
    updateBeatFrequency(); updateBeatVolume(); updateNoiseVolume();
  </script>
</body>
</html>
